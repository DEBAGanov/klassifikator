# ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è SSL - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## ‚úÖ –£ –≤–∞—Å –£–ñ–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è!

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

**cert-manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:**
- ‚è∞ –ó–∞ 30 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ü§ñ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üìß –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ email: baganovs@gmail.com
- üìÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt –¥–µ–π—Å—Ç–≤—É—é—Ç 90 –¥–Ω–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
kubectl get certificate -n klassifikator
```

---

## üÜï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–µ–Ω–¥–∏–Ω–≥–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä—ã–π (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)

```bash
# –ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–∏—Ç—å pizza.volzhck.ru
./scripts/add-new-subdomain.sh pizza

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# ‚úÖ –°–æ–∑–¥–∞—Å—Ç Certificate
# ‚úÖ –û–±–Ω–æ–≤–∏—Ç Ingress
# ‚úÖ –î–æ–∂–¥–µ—Ç—Å—è –≤—ã–ø—É—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
# ‚úÖ –í—ã–≤–µ–¥–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
```

**–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞:**
1. –°–æ–∑–¥–∞–π—Ç–µ DNS A-–∑–∞–ø–∏—Å—å: `pizza.volzhck.ru` ‚Üí `89.223.127.140`
2. –ß–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤!
3. –û—Ç–∫—Ä–æ–π—Ç–µ https://pizza.volzhck.ru

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Wildcard (–õ–£–ß–®–ò–ô - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–¥–∏–Ω —Ä–∞–∑!)

**–° wildcard —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º –Ω–æ–≤—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò!**

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –î–æ—Å—Ç—É–ø –∫ API –≤–∞—à–µ–≥–æ DNS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Cloudflare, Route53, etc.)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Cloudflare:

1. **–ü–æ–ª—É—á–∏—Ç–µ API Token:**
   - https://dash.cloudflare.com/profile/api-tokens
   - Create Token ‚Üí Edit zone DNS
   - Zone / DNS / Edit –¥–ª—è –¥–æ–º–µ–Ω–∞ volzhck.ru

2. **–°–æ–∑–¥–∞–π—Ç–µ Secret:**
```bash
kubectl create secret generic cloudflare-api-token-secret \
  --from-literal=api-token=YOUR_TOKEN_HERE \
  -n cert-manager
```

3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ wildcard –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à API token
nano k8s/base/certificate-wildcard-dns01.yaml

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ
kubectl apply -f k8s/base/certificate-wildcard-dns01.yaml
kubectl apply -f k8s/base/ingress-wildcard.yaml

# –î–æ–∂–¥–∏—Ç–µ—Å—å –≤—ã–ø—É—Å–∫–∞ (3-5 –º–∏–Ω—É—Ç)
kubectl get certificate wildcard-volzhck-ru -n klassifikator -w
```

4. **–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –¥–ª—è –Ω–æ–≤—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥–æ–≤:**
   - ‚úÖ –ü—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–π—Ç–µ DNS –∑–∞–ø–∏—Å—å
   - ‚úÖ SSL —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
   - ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å Ingress!

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
kubectl get certificate -n klassifikator
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
kubectl describe certificate modernissimo-volzhck-ru-tls -n klassifikator
```

### –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
kubectl get secret modernissimo-volzhck-ru-tls -n klassifikator -o jsonpath='{.data.tls\.crt}' | base64 -d | openssl x509 -noout -dates
```

### –õ–æ–≥–∏ cert-manager
```bash
kubectl logs -n cert-manager -l app=cert-manager --tail=50
```

---

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –≤—ã–ø—É—Å–∫–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Challenge:**
```bash
kubectl get challenges -n klassifikator
kubectl describe challenge <challenge-name> -n klassifikator
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Order:**
```bash
kubectl get order -n klassifikator
kubectl describe order <order-name> -n klassifikator
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS:**
```bash
nslookup your-subdomain.volzhck.ru
# –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å: 89.223.127.140
```

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫, –Ω–æ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
kubectl logs -n cert-manager -l app=cert-manager | grep -i renew

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
kubectl delete certificate <cert-name> -n klassifikator
kubectl apply -f k8s/base/ingress.yaml
```

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ú–µ—Ç–æ–¥ | –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ | –ù–æ–≤—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-------|---------------|-----------------|-----------|
| **–¢–µ–∫—É—â–∏–π (HTTP-01)** | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | ‚öôÔ∏è –°–∫—Ä–∏–ø—Ç | ‚≠ê‚≠ê –ü—Ä–æ—Å—Ç–æ |
| **Wildcard (DNS-01)** | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | ‚≠ê‚≠ê‚≠ê –¢—Ä–µ–±—É–µ—Ç API |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### –ï—Å–ª–∏ —É –≤–∞—Å < 10 –ª–µ–Ω–¥–∏–Ω–≥–æ–≤:
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥** (HTTP-01) + —Å–∫—Ä–∏–ø—Ç `add-new-subdomain.sh`

### –ï—Å–ª–∏ —É –≤–∞—Å > 10 –ª–µ–Ω–¥–∏–Ω–≥–æ–≤ –∏–ª–∏ —á–∞—Å—Ç—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:
‚úÖ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ wildcard** (DNS-01) - –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è!

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- Wildcard –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: `docs/WILDCARD_SSL_SETUP.md`
- SSL —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: `docs/SSL_SETUP_GUIDE.md`
- cert-manager docs: https://cert-manager.io/docs/

---

**üéâ –í—ã–≤–æ–¥:** –£ –≤–∞—Å —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ! –î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ wildcard.

